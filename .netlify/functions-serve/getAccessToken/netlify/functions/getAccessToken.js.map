{
  "version": 3,
  "sources": ["../../media/emperorbrains/Projects/eb-pcr-analysis/netlify/functions/getAccessToken.ts"],
  "sourceRoot": "/tmp/tmp-178584-Nl2BJdkHtGb2",
  "sourcesContent": ["// netlify/functions/get-angel-token.ts\n\nexport const handler = async () => {\n  try {\n    const response = await fetch(\n      \"https://apiconnect.angelone.in/rest/auth/angelbroking/user/v1/loginByPassword\",\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Accept: \"application/json\",\n          // \"X-UserType\": \"USER\",\n          // \"X-SourceID\": \"WEB\",\n          \"X-PrivateKey\": process.env.ANGEL_API_KEY,\n        },\n        body: JSON.stringify({\n          clientcode: process.env.ANGEL_CLIENT_CODE,\n          password: process.env.ANGEL_PASSWORD,\n          totp: process.env.ANGEL_TOTP || \"131604\",\n        }),\n      }\n    );\n\n    console.log(\"demo -->\", response);\n\n    if (!response.ok) {\n      throw new Error(`Login failed: ${response.status}`);\n    }\n\n    const data = await response.json();\n    const token = data?.data?.jwtToken;\n\n    if (!token) {\n      throw new Error(\"JWT token missing in response\");\n    }\n\n    return {\n      statusCode: 200,\n      body: JSON.stringify({ success: true, token }),\n    };\n  } catch (error: any) {\n    console.error(\"Error fetching Angel One token:\", error);\n    return {\n      statusCode: 500,\n      body: JSON.stringify({\n        success: false,\n        message: error.message || \"Internal Server Error\",\n      }),\n    };\n  }\n};\n\n// export async function handler() {\n//   try {\n//     const response = await fetch(\n//       \"https://api.smartapi.angelbroking.com/v1/api/token\",\n//       {\n//         method: \"POST\",\n//         headers: {\n//           \"Content-Type\": \"application/json\",\n//           Accept: \"application/json\",\n//           \"X-Client-Code\": process.env.ANGEL_CLIENT_CODE,\n//           \"X-API-Key\": process.env.ANGEL_API_KEY,\n//         },\n//         body: JSON.stringify({\n//           clientcode: process.env.ANGEL_CLIENT_CODE,\n//           password: process.env.ANGEL_PASSWORD,\n//           totp: process.env.ANGEL_TOTP,\n//           request_token: process.env.ANGEL_REQUEST_TOKEN,\n//         }),\n//       }\n//     );\n\n//     const data = await response.json();\n//     console.log(\"SmartAPI token response:\", data);\n\n//     if (!data.status || !data.data?.jwtToken) {\n//       throw new Error(\"Failed to get Angel One JWT token\");\n//     }\n\n//     return {\n//       statusCode: 200,\n//       body: JSON.stringify({ success: true, token: data.data.jwtToken }),\n//     };\n//   } catch (err) {\n//     console.error(\"Error fetching Angel One token:\", err);\n//     return {\n//       statusCode: 500,\n//       body: JSON.stringify({ success: false, message: err.message }),\n//     };\n//   }\n// }\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEO,IAAM,UAAU,YAAY;AACjC,MAAI;AACF,UAAM,WAAW,MAAM;AAAA,MACrB;AAAA,MACA;AAAA,QACE,QAAQ;AAAA,QACR,SAAS;AAAA,UACP,gBAAgB;AAAA,UAChB,QAAQ;AAAA;AAAA;AAAA,UAGR,gBAAgB,QAAQ,IAAI;AAAA,QAC9B;AAAA,QACA,MAAM,KAAK,UAAU;AAAA,UACnB,YAAY,QAAQ,IAAI;AAAA,UACxB,UAAU,QAAQ,IAAI;AAAA,UACtB,MAAM,QAAQ,IAAI,cAAc;AAAA,QAClC,CAAC;AAAA,MACH;AAAA,IACF;AAEA,YAAQ,IAAI,YAAY,QAAQ;AAEhC,QAAI,CAAC,SAAS,IAAI;AAChB,YAAM,IAAI,MAAM,iBAAiB,SAAS,MAAM,EAAE;AAAA,IACpD;AAEA,UAAM,OAAO,MAAM,SAAS,KAAK;AACjC,UAAM,QAAQ,MAAM,MAAM;AAE1B,QAAI,CAAC,OAAO;AACV,YAAM,IAAI,MAAM,+BAA+B;AAAA,IACjD;AAEA,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,MAAM,KAAK,UAAU,EAAE,SAAS,MAAM,MAAM,CAAC;AAAA,IAC/C;AAAA,EACF,SAAS,OAAY;AACnB,YAAQ,MAAM,mCAAmC,KAAK;AACtD,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,MAAM,KAAK,UAAU;AAAA,QACnB,SAAS;AAAA,QACT,SAAS,MAAM,WAAW;AAAA,MAC5B,CAAC;AAAA,IACH;AAAA,EACF;AACF;",
  "names": []
}
