{
  "version": 3,
  "sources": ["../../media/emperorbrains/Projects/eb-pcr-analysis/netlify/functions/nse-proxy.ts"],
  "sourceRoot": "/tmp/tmp-178584-yV9mdAgsYp88",
  "sourcesContent": ["import type { Handler } from \"@netlify/functions\";\n\nexport const handler: Handler = async (event) => {\n  const symbol = event.queryStringParameters?.symbol || \"NIFTY\";\n\n  try {\n    // Step 1: Get cookies first\n    const cookieResponse = await fetch(\"https://www.nseindia.com\", {\n      headers: {\n        \"User-Agent\":\n          \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",\n        Accept: \"text/html,application/xhtml+xml\",\n      },\n    });\n\n    const cookies = cookieResponse.headers.get(\"set-cookie\");\n\n    // Step 2: Fetch actual data\n    const url = `https://www.nseindia.com/api/option-chain-indices?symbol=${symbol}`;\n\n    const response = await fetch(url, {\n      headers: {\n        \"User-Agent\":\n          \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",\n        Accept: \"application/json\",\n        Referer: \"https://www.nseindia.com/option-chain\",\n        Cookie: cookies || \"\",\n      },\n    });\n\n    const text = await response.text();\n    let data;\n\n    try {\n      data = JSON.parse(text);\n    } catch {\n      // NSE returned HTML (bot protection)\n      return {\n        statusCode: 502,\n        body: JSON.stringify({\n          error: \"NSE blocked the request. Try again later.\",\n          htmlSnippet: text.slice(0, 100),\n        }),\n      };\n    }\n\n    return {\n      statusCode: 200,\n      headers: {\n        \"Access-Control-Allow-Origin\": \"*\",\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(data),\n    };\n  } catch (error: any) {\n    return {\n      statusCode: 500,\n      body: JSON.stringify({ error: error.message }),\n    };\n  }\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEO,IAAM,UAAmB,OAAO,UAAU;AAC/C,QAAM,SAAS,MAAM,uBAAuB,UAAU;AAEtD,MAAI;AAEF,UAAM,iBAAiB,MAAM,MAAM,4BAA4B;AAAA,MAC7D,SAAS;AAAA,QACP,cACE;AAAA,QACF,QAAQ;AAAA,MACV;AAAA,IACF,CAAC;AAED,UAAM,UAAU,eAAe,QAAQ,IAAI,YAAY;AAGvD,UAAM,MAAM,4DAA4D,MAAM;AAE9E,UAAM,WAAW,MAAM,MAAM,KAAK;AAAA,MAChC,SAAS;AAAA,QACP,cACE;AAAA,QACF,QAAQ;AAAA,QACR,SAAS;AAAA,QACT,QAAQ,WAAW;AAAA,MACrB;AAAA,IACF,CAAC;AAED,UAAM,OAAO,MAAM,SAAS,KAAK;AACjC,QAAI;AAEJ,QAAI;AACF,aAAO,KAAK,MAAM,IAAI;AAAA,IACxB,QAAQ;AAEN,aAAO;AAAA,QACL,YAAY;AAAA,QACZ,MAAM,KAAK,UAAU;AAAA,UACnB,OAAO;AAAA,UACP,aAAa,KAAK,MAAM,GAAG,GAAG;AAAA,QAChC,CAAC;AAAA,MACH;AAAA,IACF;AAEA,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS;AAAA,QACP,+BAA+B;AAAA,QAC/B,gBAAgB;AAAA,MAClB;AAAA,MACA,MAAM,KAAK,UAAU,IAAI;AAAA,IAC3B;AAAA,EACF,SAAS,OAAY;AACnB,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,MAAM,KAAK,UAAU,EAAE,OAAO,MAAM,QAAQ,CAAC;AAAA,IAC/C;AAAA,EACF;AACF;",
  "names": []
}
